<div id="dashboard">
    <h1>DASHBOARD</h1>
    <div id='chart-container'>
        <canvas id="chart"></canvas>
    </div>
    <section>
        <% @courses.each do |course| %>
        <div class="course">
            <div class="name"><%= course.name %></div>
            <div class="number"><%= course.number %></div>
            <div id="tally-<%= course.id %>" class="stat"><%= course.counters.size %>
                People</div>
            <div class="actions">
                <button class="add" onclick="tally(<%= course.id %>)">+</button>
                <button class="remove" onclick="unTally(<%= course.id %>)">-</button>
            </div>
        </div>
        <% end %>
        <div class="text-center">
            <a href="/add">Add New Course</a>
        </div>
    </section>
    <script type="text/javascript">
        function unTally(id) {
            $.get('remove-counter/' + id).success(function (counters) {
                $('#tally-' + id).html(counters.length + ' People');
            });
        }
        function tally(id) {
            // $ = jquery
            //
            // $.get = makes a GET request to your server
            $.get('example-count/' + id + '/1').success(function (counters) {
                $('#tally-' + id).html(counters.length + ' People');
            }).error(console.error);
        }

        var courses = <%= @courses.to_json(include: :counters).html_safe %>;
        var context = document.querySelector('#chart');

        // Holds the chart labels
        var labels = courses.map((course) => course.number);
        // holds the bars for each course
        var dataSets = courses.map((course) => course.counters.length);

        var chart = new Chart(context, {
            options: {
                maintainAspectRatio: false,
                scales: {
                    xAxes: [
                        {
                            gridLines: {
                                color: "rgba(0, 0, 0, 0)"
                            }
                        }
                    ],
                    yAxes: [
                        {
                            gridLines: {
                                color: "rgba(0, 0, 0, 0)"
                            }
                        }
                    ]
                }
            },
            type: 'horizontalBar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Students Advised:',
                        data: dataSets,
                        backgroundColor: courses.map((c, i) => {})
                    }
                ]
            }
        });

        // write a function to update the chart
        function updateChart() {
            chart.data.datasets[0].data = courses.map((course) => course.counters.length);
            chart.update();
        }

        // Every so often, get the latest counts, and update the courses array
        setInterval(function () {
            $.get('/all-courses').success(newCourses => {
                courses = newCourses;
                updateChart();
            });
        }, 3000);
    </script>
</div>
updateChart();
</script>
</div>
>
</div>
